<div class="container" ng-click="hideMenu()">
  <div class="col-md-12" ng-show="listLocation === false">
    <div class="clear-70"></div>
    <h1>Please provide a location for the data server:</h1>
    <div class="prepare-list">
      <form name="preList">
        <div class="btn-group half-width">
          <input type="text" ng-model="uriPath" name="uriPath" id="uriPath" class="nginput pull-left" placeholder="https://example.org/" autofocus />
          <button class="btn btn-primary" ng-click="prepareList(uriPath)"><i class="fa fa-search fa-2x"></i></button>
        </div>
      </form>
    </div>
  </div>
  <div ng-cloak class="col-md-12" ng-show="listLocation === true">
    <table class="create-new">
      <tr>
        <td>
          <div class="btn-group" dropdown>
            <button type="button" class="btn btn-success dropdown-toggle" ng-disabled="disabled" tooltip-placement="bottom" tooltip="New..."><i class="fa fa-2x fa-plus"></i></button>
            <ul class="dropdown-menu" role="menu">
              <li><a href ng-click="openNewDir()"><i class="fa fa-2x fa-folder-open-o fa-fw vmiddle"></i> Directory</a></li>
              <li><a href ng-click="openNewFile()"><i class="fa fa-2x fa-file-o fa-fw vmiddle"></i> File</a></li>
              <li><a href ng-click="openNewUpload(path)"><i class="fa fa-2x fa-cloud-upload fa-fw vmiddle"></i> Upload</a></li>
            </ul>
          </div>
    		</td>
        <td>
          <div id="crumbs" class="collapse navbar-collapse">
            <ul>
              <li ng-repeat="crumb in breadCrumbs">
                <a href="{{crumb.uri}}"><i class="fa" ng-class="$first?'fa-home':'fa-folder-open-o'"></i> {{crumb.name}}</a>
                </li>
      			</ul>
    	   	</div>
    		</td>
      </tr>
    </table>
    <div class="index">
			<table class="box-shadow">
				<thead>
					<th class="filename">Name</th>
					<th>Size</th>
					<th>Modified</th>
					<th class="right">More</th>
				</thead>
        <tr ng-show="emptyDir">
          <td colspan="4"><h2>No files found</h2></td>
        </tr>
				<tr ng-repeat="res in resources|orderBy:['type','name'] track by res.id">
					<td colspan="{{res.type==='-'?4:1}}"><a href="{{res.path}}" target="{{res.type=='File'?'_blank':''}}"><i class="fa fa-fw vmiddle" ng-class="res.type=='Directory'||res.type==='-'?'fa-folder-open-o':'fa-file-o'"></i> {{res.name}}</a></td>
					<td ng-hide="res.type==='-'">{{res.size|fileSize}}</td>
					<td ng-hide="res.type==='-'"><div tooltip-placement="bottom" tooltip="{{res.mtime|classicDate}}">{{res.mtime|fromNow}}</div></td>
					<td ng-hide="res.type==='-'" class="right">
						<div class="btn-group" dropdown is-open="status.isopen">
              <button type="button" class="btn btn-primary dropdown-toggle" ng-disabled="disabled">
                <i class="fa fa-angle-double-down"></i>
              </button>
					      <ul class="dropdown-menu dropdown-menu-right left" role="menu">
					        <li><a href="#" ng-show="res.type != 'Directory'"><i class="fa fa-2x fa-pencil-square-o fa-fw vmiddle"></i> View/Edit</a></li>
					        <li><a href ng-click="openACLEditor(res.uri, res.type)"><i class="fa fa-2x fa-unlock-alt fa-fw vmiddle"></i> Permissions</a></li>
					        <li><a href ng-click="openDelete(res.uri)"><i class="fa fa-2x fa-trash-o fa-fw vmiddle"></i> Delete</a></li>
					      </ul>
					    </div>
					</td>
				</tr>
			</table>
		</div>
	</div>

  <!-- New dir modal -->
  <script type="text/ng-template" id="newdir.html">
    <div>
      <div class="modal-header">
            <h3 class="modal-title">New directory</h3>
        </div>
        <div class="modal-body">
          <form name="newDirName">
            <fieldset>
              <input type="text" ng-model="dirName" name="dirName" id="dirName" class="nginput" placeholder="dir name.." ng-focus="isFocused" ng-keypress="($event.which === 13)?newDir(dirName):0" />
              <span ng-hide="newDirName.dirName.$valid">Only use: a-z A-Z 0-9 _ -</span>
            </fieldset>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" ng-click="newDir(dirName)">OK</button>
          <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </div>
  </script>

  <!-- New file modal -->
  <script type="text/ng-template" id="newfile.html">
    <div>
      <div class="modal-header">
            <h3 class="modal-title">New file</h3>
        </div>
        <div class="modal-body">
          <form name="newFileName">
            <fieldset>
              <input type="text" ng-model="fileName" name="fileName" id="fileName" class="nginput" placeholder="file name.." ng-focus="isFocused" ng-keypress="($event.which === 13)?newFile(fileName):0" />
              <!-- <span ng-hide="newFileName.fileName.$valid">Only use: a-z A-Z 0-9 _ - .</span> -->
            </fieldset>
          </form>
          <br/><small class="orange">Warning: creating a new file may overwrite an existing one with the same name!</small>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" ng-click="newFile(fileName)">OK</button>
          <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </div>
  </script>

  <!-- Upload file modal -->
  <script type="text/ng-template" id="uploadfiles.html">
    <div>
      <div class="modal-header">
        <h3 class="modal-title">Upload files to <strong>{{container}}/</strong></h3>
      </div>
      <div class="modal-body">
        <input type="file" ng-file-select="onFileSelect($files)" data-multiple="true" multiple="multiple">
        <div ng-file-drop="onFileSelect($files)" ng-file-drag-over-class="'dropzone-on'" class="dropzone" ng-show="dropSupported">
          Drop files here
        </div>
        <div ng-file-drop-available="dropSupported=true" ng-show="!dropSupported">
          HTML5 Drop File is not supported!
        </div>
        <table class="upload-files" ng-show="selectedFiles.length > 0">
          <tr>
            <td><strong>File name</strong></td>
            <td><strong>Status</strong></td>
            <td></td>
          </tr>
          <tr ng-repeat="file in selectedFiles track by $index" ng-class="progress[file.name] == 100?'done':''">
            <td>{{file.name|truncate:25}}</td>
            <td><progressbar value="progress[file.name]"></progressbar></td>
            <td class="pull-right">
              <button ng-hide="progress[file.name] == 100" class="btn btn-mini btn-default" ng-click="abort(file.name)"><i class="fa fa-2x fa-times"></i></button>
              <button ng-show="progress[file.name] == 100" class="btn btn-mini btn-default" ng-click="remove(file.name)"><i class="fa fa-2x fa-trash-o"></i></button>
            </td>
          </tr>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" ng-click="clearUploaded()" ng-show="selectedFiles.length > 0">Clear uploaded</button>
        <button class="btn btn-default" ng-click="cancel()">Close</button>
      </div>
    </div>
  </script>

  <!-- Remove resource modal -->
  <script type="text/ng-template" id="delete.html">
    <div>
      <div class="modal-header">
            <h3 class="modal-title"><i class="fa fa-2x fa-trash-o fa-fw vmiddle"></i> Delete resource</h3>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete:</p>
          <p><strong>{{resource}}</strong></p>
          <small>Note: make sure directories are empty before removing them.</small>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" ng-click="deleteResource(resource)">Yes</button>
          <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </div>
  </script>
  
  <!-- ACL editor modal -->
  <script type="text/ng-template" id="acleditor.html">
    <div>
      <div class="modal-header">
        <h3 class="modal-title">Permissions for <strong>{{resource}}</strong></h3>
        <img ng-src="assets/loading.gif" ng-show="loading">  
      </div>
        <div class="modal-body">
          <table class="full-width">
            <tr>
              <td class="pull-left">
                <div class="permission-icons">
                  <strong>Owners</strong>
                  <br/>
                  <i class="fa fa-2x fa-lock vmiddle"></i>
                </div>
              </td>
              <td class="vtop">
                <div class="policy" ng-repeat="policy in policies|filter:{cat: 'owner'}">
                  <div class="pull-left">
                    <img ng-src="assets/loading.gif" ng-show="policy.loading" />
                    <button class="btn btn-sm" ng-click="removeUser(policy.uri, policy.webid)" ng-hide="policy.loading"><i class="fa fa-trash-o orange"></i></button>
                    <a href="{{policy.webid}}" target="_blank">{{trunc(policy.fullname, 25)}}</a>
                  </div>
                  <br/>
                </div>
                <div class="spacer">
                  <div class="policy" ng-show="newUser['owner']">
                    <input class="new-user" type="text" ng-model="newUser['owner'].webid" />
                    <button class="btn btn-sm btn-primary" ng-click="addNewUser('owner', newUser['owner'].webid)"><i class="fa fa-plus"></i></button>
                    <button class="btn btn-sm" ng-click="cancelNewUser('owner')">Cancel</button>
                    <br/>
                  </div>
                  <button class="btn btn-primary" ng-click="showNewUser('owner')"><i class="fa fa-plus"></i></button>
                </div>
              </td>
            </tr>
            <tr><td colspan="2"><hr/></td></tr>
            <tr>
              <td class="pull-left">
                <div class="permission-icons">
                  <strong>Users</strong>
                  <br/>
                  <i class="fa fa-2x fa-user vmiddle"></i>
                </div>
              </td>
              <td class="vtop">
                <div class="policy" ng-repeat="policy in policies|filter:{cat: 'user'}">
                  <div class="pull-left">
                    <img ng-src="assets/loading.gif" ng-show="policy.loading" />
                    <button class="btn btn-sm" ng-click="removeUser(policy.uri, policy.webid)" ng-hide="policy.loading"><i class="fa fa-trash-o orange"></i></button>
                    <a href="{{policy.webid}}" target="_blank">{{trunc(policy.fullname, 25)}}</a>
                  </div>
                  <div class="boxes pull-right">
                      <input type="checkbox" ng-model="policy.modes.Read"/><div class="mode-label">Read</div>
                      <input type="checkbox" ng-model="policy.modes.Write"/><div class="mode-label">Write</div>
                      <input type="checkbox" ng-model="policy.modes.Append"/><div class="mode-label" tooltip-placement="bottom" tooltip="Able to write without reading or deleting.">Append</div>
                      <input type="checkbox" ng-model="policy.defaultForNew" ng-show="resType == 'Directory'"/><div class="mode-label" tooltip-placement="bottom" tooltip="Applies to all resources within this directory." ng-show="resType == 'Directory'">Recursive</div>
                  </div>
                  <br/>
                </div>
                <div class="spacer">
                  <div class="policy" ng-show="newUser['user']">
                    <input class="new-user" type="text" ng-model="newUser['user'].webid" />
                    <button class="btn btn-sm btn-primary" ng-click="addNewUser('user', newUser['user'].webid)"><i class="fa fa-plus"></i></button>
                    <button class="btn btn-sm" ng-click="cancelNewUser('user')">Cancel</button>
                    <br/>
                  </div>
                  <button class="btn btn-primary" ng-click="showNewUser('user')"><i class="fa fa-plus"></i></button>
                </div>
              </td>
            </tr>
            <tr><td colspan="2"><hr/></td></tr>
            <tr>
              <td class="pull-left">
                <div class="permission-icons">
                  <strong>Groups</strong>
                  <br/>
                  <i class="fa fa-2x fa-users vmiddle"></i>
                </div>
              </td>
              <td class="vtop">
                <div class="policy" ng-repeat="policy in policies|filter:{cat: 'group'}">
                  <div class="pull-left">
                    <img ng-src="assets/loading.gif" ng-show="policy.loading" />
                    <button class="btn btn-sm" ng-click="removeUser(policy.uri, policy.webid)" ng-hide="policy.loading"><i class="fa fa-trash-o orange"></i></button>
                    <a href="{{policy.webid}}" target="_blank">{{trunc(policy.fullname, 25)}}</a>
                  </div>
                  <div class="boxes pull-right">
                      <input type="checkbox" ng-model="policy.modes.Read"/><div class="mode-label">Read</div>
                      <input type="checkbox" ng-model="policy.modes.Write"/><div class="mode-label">Write</div>
                      <input type="checkbox" ng-model="policy.modes.Append"/><div class="mode-label" tooltip-placement="bottom" tooltip="Able to write without reading or deleting.">Append</div>
                      <input type="checkbox" ng-model="policy.defaultForNew" ng-show="resType == 'Directory'"/><div class="mode-label" tooltip-placement="bottom" tooltip="Applies to all resources within this directory." ng-show="resType == 'Directory'">Recursive</div>
                  </div>
                  <br/>
                </div>
                <div class="spacer">
                  <div class="policy" ng-show="newUser['group']">
                    <input class="new-user" type="text" ng-model="newUser['group'].webid" />
                    <button class="btn btn-sm btn-primary" ng-click="addNewUser('group', newUser['group'].webid)"><i class="fa fa-plus"></i></button>
                    <button class="btn btn-sm" ng-click="cancelNewUser('group')">Cancel</button>
                    <br/>
                  </div>
                  <button class="btn btn-primary" ng-click="showNewUser('group')"><i class="fa fa-plus"></i></button>
                </div>
              </td>
            </tr>
            <tr><td colspan="2"><hr/></td></tr>
            <tr>
              <td class="pull-left">
                <div class="permission-icons">
                  <strong>Others</strong>
                  <br/>
                  <i class="fa fa-2x fa-unlock-alt vmiddle"></i>
                </div>
              </td>
              <td class="vtop">
                <div ng-repeat="policy in policies|filter:{cat: 'others'}|limitTo:1">
                  <div class="pull-left">
                   Everyone
                  </div>
                  <div class="boxes pull-right">
                      <input type="checkbox" ng-model="policy.modes.Read"/><div class="mode-label">Read</div>
                      <input type="checkbox" ng-model="policy.modes.Write"/><div class="mode-label">Write</div>
                      <input type="checkbox" ng-model="policy.modes.Append"/><div class="mode-label" tooltip-placement="bottom" tooltip="Able to write without reading or deleting.">Append</div>
                      <input type="checkbox" ng-model="policy.defaultForNew" ng-show="resType == 'Directory'"/><div class="mode-label" tooltip-placement="bottom" tooltip="Applies to all resources within this directory." ng-show="resType == 'Directory'">Recursive</div>
                  </div>
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" ng-click="setAcl()">Set permissions</button>
          <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </div>
  </script>
</div>
